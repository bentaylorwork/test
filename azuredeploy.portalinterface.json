{
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "networkingInfo",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                    "text": "The below details can be found in the UKFast's Tech DB.",
                    "link": {
                        "label": "",
                        "uri": ""
                    }
                }
            },
            {
                "name": "ukFastCustomerId",
                "type": "Microsoft.Common.TextBox",
                "label": "UKFast Customer ID",
                "defaultValue": "",
                "toolTip": "UKfast Customer ID taken from Tech DB.",
                "constraints": {
                    "required": true
                }
            },
            {
                "name": "ukFastCustomername",
                "type": "Microsoft.Common.TextBox",
                "label": "UKFast Customer Name",
                "defaultValue": "",
                "toolTip": "UKfast Customer Name taken from Tech DB. This should be abbreviated from example UKFast becomes ukf.",
                "constraints": {
                    "required": true
                }
            }
        ],
        "steps": [
            {
                "name": "landingZoneAzurePolicy",
                "label": "Landing Zone - Azure Policy",
                "elements": [
                    {
                        "name": "networkingInfo",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "The below details can be found in the UKFast's Tech DB.",
                            "link": {
                                "label": "",
                                "uri": ""
                            }
                        }
                    },
                    {
                        "name": "esLocationsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "locations?api-version=2019-11-01"
                        }
                    },
                    {
                        "name": "landingZoneAzurePolicyCost",
                        "type": "Microsoft.Common.Section",
                        "label": "Azure Policy - Cost",
                        "elements": [
                            {
                                "name": "networkingInfo",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "The details below allow.",
                                    "link": {
                                        "label": "",
                                        "uri": ""
                                    }
                                }
                            },
                            {
                                "name": "azurePolicyCost",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Azure Policy - Cost Savings",
                                "defaultValue": "small",
                                "toolTip": "The size of resources that will be allowed to be deployed into the Subscription.",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "Small",
                                            "value": "small"
                                        },
                                        {
                                            "label": "Medium",
                                            "value": "medium"
                                        },
                                        {
                                            "label": "Large",
                                            "value": "large"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            }
                        ]
                    },
                    {
                        "name": "landingZoneAzurePolicyRegion",
                        "type": "Microsoft.Common.Section",
                        "label": "Azure Policy - Data Sovereignty",
                        "elements": [
                            {
                                "name": "networkingInfo",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "The details below allow.",
                                    "link": {
                                        "label": "",
                                        "uri": ""
                                    }
                                }
                            },
                            {
                                "name": "azurePolicyLocation",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Allowed Azure Regions",
                                "multiselect": true,
                                "filter": true,
                                "toolTip": "Select the target region for you connectivity deployment (requires you to provide a subscriptionId for connectivity)",
                                "constraints": {
                                    "allowedValues": "[map(steps('landingZoneAzurePolicy').esLocationsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.name, '\"}')))]",
                                    "required": true
                                }
                            }
                        ],
                        "visible": true
                    }
                ]
            },
            {
                "name": "landingZoneNetworking",
                "label": "Landing Zone - Networking",
                "elements": [
                    {
                        "name": "networkingInfo",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "The details below are used to deploy the only allowed virtual network into the Azure Landing Zone.",
                            "link": {
                                "label": "",
                                "uri": ""
                            }
                        }
                    },
                    {
                        "name": "vnet",
                        "type": "Microsoft.Network.VirtualNetworkCombo",
                        "label": {
                            "virtualNetwork": "Virtual network",
                            "subnets": "Subnets"
                        },
                        "toolTip": {
                            "virtualNetwork": "",
                            "subnets": ""
                        },
                        "defaultValue": {
                            "name": "vnet01",
                            "addressPrefixSize": "/16"
                        },
                        "constraints": {
                            "minAddressPrefixSize": "/16"
                        },
                        "options": {
                            "hideExisting": false
                        },
                        "subnets": {
                            "subnet1": {
                                "label": "First subnet",
                                "defaultValue": {
                                    "name": "subnet-1",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": true
                                }
                            },
                            "subnet2": {
                                "label": "Second subnet",
                                "defaultValue": {
                                    "name": "subnet-2",
                                    "addressPrefixSize": "/26"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/26",
                                    "minAddressCount": 8,
                                    "requireContiguousAddresses": true
                                }
                            }
                        },
                        "visible": true
                    }
                ]
            }
        ],
        "outputs": {
            "customerId": "[basics('ukFastCustomerId')]",
            "customerName": "[basics('ukFastCustomerName')]",
            "listOfAllowedLocations": "[steps('landingZoneAzurePolicy').azurePolicyLocation]",
            "costRestriction": "[steps('landingZoneAzurePolicy').azurePolicyCost]"
        }
    }
}
